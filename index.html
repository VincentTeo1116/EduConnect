<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EduConnect Learning Centre</title>
  <link rel="icon" href="Images/Logo.png" type="image/png">
  <link rel="stylesheet" href="App.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
  <div id="root"></div>
  
  <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <script type="text/babel">
    const { useState, useEffect } = React;

    // LoginPage Component
    const LoginPage = ({ loginData, setLoginData, handleLogin, goToRegister }) => (
      <div className="form-container">
        <div style={{ textAlign: 'center', marginBottom: '20px' }}>
          <img src="Images/Logo.png" alt="EduConnect Logo" className="logo" />
        </div>
        <h2 style={{
          fontSize: '32px',
          fontWeight: '300',
          background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
          WebkitBackgroundClip: 'text',
          WebkitTextFillColor: 'transparent',
          marginBottom: '25px',
          textAlign: 'center',
          letterSpacing: '0.5px'
        }}>
          Login to EduConnect
        </h2>
        <form onSubmit={handleLogin}>
          <input 
            type="email" 
            placeholder="Email" 
            value={loginData.email} 
            onChange={e => setLoginData({ ...loginData, email: e.target.value })} 
            required 
          />
          <input 
            type="password" 
            placeholder="Password" 
            value={loginData.password} 
            onChange={e => setLoginData({ ...loginData, password: e.target.value })} 
            required 
          />
          <button type="submit" className="btn-primary">Login</button>
        </form>
      </div>
    );

    // RegisterPage Component
    const RegisterPage = ({ registerData, setRegisterData, handleRegister, goToLogin }) => (
      <div className="form-container">
        <div style={{ textAlign: 'center', marginBottom: '20px' }}>
          <img src="Images/Logo.png" alt="EduConnect Logo" className="logo" />
        </div>
        <h2
          style={{
            fontSize: '32px',
            fontWeight: '300',
            background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
            WebkitBackgroundClip: 'text',
            WebkitTextFillColor: 'transparent',
            marginBottom: '25px',
            textAlign: 'center',
            letterSpacing: '0.5px'
          }}
        >Register for EduConnect</h2>
        <form onSubmit={handleRegister}>
          <input 
            type="text" 
            placeholder="Full Name" 
            value={registerData.name} 
            onChange={e => setRegisterData({ ...registerData, name: e.target.value })} 
            required 
          />
          <input 
            type="email" 
            placeholder="Email Address" 
            value={registerData.email} 
            onChange={e => setRegisterData({ ...registerData, email: e.target.value })} 
            required 
          />
          <input 
            type="password" 
            placeholder="Password" 
            value={registerData.password} 
            onChange={e => setRegisterData({ ...registerData, password: e.target.value })} 
            required 
          />
          <select 
            value={registerData.role} 
            onChange={e => setRegisterData({ ...registerData, role: e.target.value })} 
            required
          >
            <option value="">Select Role</option>
            <option value="Student">Student</option>
            <option value="Instructor">Instructor</option>
            <option value="System Administrator">System Administrator</option>
            <option value="Exam Administrator">Exam Administrator</option>
          </select>
          <button type="submit" className="btn-primary">Register</button>
        </form>
        <p>
          Already have an account?{' '}
          <button onClick={goToLogin} className="btn-secondary">Login</button>
        </p>
      </div>
    );

    // StudentDashboard Component
    const StudentDashboard = ({ 
      currentUser, 
      assessments, 
      submissions, 
      questions, 
      setSubmissions, 
      setQuestions, 
      handleLogout, 
      goToProfile 
    }) => {
      const [questionData, setQuestionData] = useState({ assessmentId: '', text: '' });

      const submitAssessment = (assessmentId) => {
        const submission = {
          id: Date.now(),
          assessmentId,
          studentId: currentUser.id,
          files: 'file.pdf',
          drafts: [{ version: 1, content: 'file.pdf', timestamp: new Date().toISOString() }],
          grade: null,
          feedback: '',
          status: 'submitted'
        };
        const updatedSubmissions = [...submissions, submission];
        setSubmissions(updatedSubmissions);
        localStorage.setItem('submissions', JSON.stringify(updatedSubmissions));
        alert('Submission successful');
      };

      const handleQuestionSubmit = (e) => {
        e.preventDefault();
        const question = {
          id: Date.now(),
          assessmentId: parseInt(questionData.assessmentId),
          studentId: currentUser.id,
          question: questionData.text,
          answers: []
        };
        const updatedQuestions = [...questions, question];
        setQuestions(updatedQuestions);
        localStorage.setItem('questions', JSON.stringify(updatedQuestions));
        setQuestionData({ assessmentId: '', text: '' });
        alert('Question submitted');
      };

      return (
        <div className="main-container">
          <header>
            <div style={{ display: 'flex', alignItems: 'center' }}>
              <img src="Images/Logo.png" alt="EduConnect Logo" className="logo" />
              <h1>Welcome, {currentUser.name} (Student)</h1>
            </div>
            <div>
              <button onClick={goToProfile} className="btn-secondary">Profile</button>
              <button onClick={handleLogout} className="btn-danger">Logout</button>
            </div>
          </header>
          <main>
            <section className="welcome-banner">
              <h2 className="welcome-title">Student Dashboard</h2>
              <p className="welcome-subtitle">
                View assessments, submit work, and ask questions
              </p>
            </section>
            
            <section>
              <h3>My Assessments ({assessments.length})</h3>
              <div className="quick-actions">
                {assessments.map(a => (
                  <div key={a.id} className="item-card">
                    <h4>{a.title}</h4>
                    <p>{a.description}</p>
                    <p><strong>Deadline:</strong> {a.deadline}</p>
                    <button 
                      onClick={() => submitAssessment(a.id)}
                      className="btn-primary"
                      style={{ marginTop: '10px', width: '100%' }}
                    >
                      Submit Assessment
                    </button>
                  </div>
                ))}
              </div>
            </section>
            
            <section>
              <h3>Ask a Question</h3>
              <form onSubmit={handleQuestionSubmit} className="form-container" style={{ maxWidth: '600px' }}>
                <select 
                  value={questionData.assessmentId} 
                  onChange={e => setQuestionData({ ...questionData, assessmentId: e.target.value })} 
                  required
                >
                  <option value="">Select Assessment</option>
                  {assessments.map(a => (
                    <option key={a.id} value={a.id}>{a.title}</option>
                  ))}
                </select>
                <textarea 
                  placeholder="Enter your question here..." 
                  value={questionData.text} 
                  onChange={e => setQuestionData({ ...questionData, text: e.target.value })} 
                  required
                  rows="4"
                />
                <button type="submit" className="btn-primary">Submit Question</button>
              </form>
            </section>
          </main>
        </div>
      );
    };

    // InstructorDashboard Component
    const InstructorDashboard = ({ 
      currentUser, 
      assessments, 
      submissions, 
      questions, 
      setAssessments, 
      setSubmissions, 
      setQuestions, 
      handleLogout, 
      goToProfile 
    }) => {
      const [assessmentData, setAssessmentData] = useState({ 
        title: '', 
        description: '', 
        course: '', 
        deadline: '', 
        criteria: '' 
      });

      const handleAssessmentSubmit = (e) => {
        e.preventDefault();
        const assessment = {
          id: Date.now(),
          title: assessmentData.title,
          description: assessmentData.description,
          course: assessmentData.course,
          deadline: assessmentData.deadline,
          criteria: assessmentData.criteria,
          instructorId: currentUser.id,
          files: []
        };
        const updatedAssessments = [...assessments, assessment];
        setAssessments(updatedAssessments);
        localStorage.setItem('assessments', JSON.stringify(updatedAssessments));
        setAssessmentData({ title: '', description: '', course: '', deadline: '', criteria: '' });
        alert('Assessment created successfully');
      };

      const gradeSubmission = (submissionId, grade) => {
        const updatedSubmissions = submissions.map(s => 
          s.id === submissionId ? { ...s, grade, status: 'graded' } : s
        );
        setSubmissions(updatedSubmissions);
        localStorage.setItem('submissions', JSON.stringify(updatedSubmissions));
      };

      const updateFeedback = (submissionId, feedback) => {
        const updatedSubmissions = submissions.map(s => 
          s.id === submissionId ? { ...s, feedback } : s
        );
        setSubmissions(updatedSubmissions);
        localStorage.setItem('submissions', JSON.stringify(updatedSubmissions));
      };

      const answerQuestion = (questionId, answer) => {
        const updatedQuestions = questions.map(q => 
          q.id === questionId ? { 
            ...q, 
            answers: [...q.answers, { 
              instructorId: currentUser.id, 
              answer, 
              official: true, 
              resolved: false 
            }] 
          } : q
        );
        setQuestions(updatedQuestions);
        localStorage.setItem('questions', JSON.stringify(updatedQuestions));
      };

      return (
        <div className="main-container">
          <header>
            <div style={{ display: 'flex', alignItems: 'center' }}>
              <img src="Images/Logo.png" alt="EduConnect Logo" className="logo" />
              <h1>Welcome, {currentUser.name} (Instructor)</h1>
            </div>
            <div>
              <button onClick={goToProfile} className="btn-secondary">Profile</button>
              <button onClick={handleLogout} className="btn-danger">Logout</button>
            </div>
          </header>
          <main>
            <section className="welcome-banner">
              <h2 className="welcome-title">Instructor Dashboard</h2>
              <p className="welcome-subtitle">
                Create assessments, grade submissions, and answer student questions
              </p>
            </section>
            
            <section>
              <h3>Create New Assessment</h3>
              <form onSubmit={handleAssessmentSubmit} className="form-container" style={{ maxWidth: '600px' }}>
                <input 
                  type="text" 
                  placeholder="Assessment Title" 
                  value={assessmentData.title} 
                  onChange={e => setAssessmentData({ ...assessmentData, title: e.target.value })} 
                  required 
                />
                <textarea 
                  placeholder="Assessment Description" 
                  value={assessmentData.description} 
                  onChange={e => setAssessmentData({ ...assessmentData, description: e.target.value })} 
                  required 
                  rows="3"
                />
                <input 
                  type="text" 
                  placeholder="Course Name" 
                  value={assessmentData.course} 
                  onChange={e => setAssessmentData({ ...assessmentData, course: e.target.value })} 
                  required 
                />
                <input 
                  type="datetime-local" 
                  value={assessmentData.deadline} 
                  onChange={e => setAssessmentData({ ...assessmentData, deadline: e.target.value })} 
                  required 
                />
                <textarea 
                  placeholder="Grading Criteria" 
                  value={assessmentData.criteria} 
                  onChange={e => setAssessmentData({ ...assessmentData, criteria: e.target.value })} 
                  required 
                  rows="3"
                />
                <button type="submit" className="btn-primary">Create Assessment</button>
              </form>
            </section>
            
            <section>
              <h3>Student Submissions ({submissions.length})</h3>
              <div className="quick-actions">
                {submissions.filter(s => 
                  assessments.find(a => a.id === s.assessmentId && a.instructorId === currentUser.id)
                ).map(s => (
                  <div key={s.id} className="item-card">
                    <h4>Submission #{s.id}</h4>
                    <p><strong>Student ID:</strong> {s.studentId}</p>
                    <p><strong>Status:</strong> {s.status}</p>
                    <p><strong>Current Grade:</strong> {s.grade || 'Not graded'}</p>
                    <div style={{ marginTop: '15px' }}>
                      <input 
                        type="number" 
                        placeholder="Enter grade" 
                        onChange={e => gradeSubmission(s.id, e.target.value)}
                        style={{ marginBottom: '10px', width: '100%', padding: '8px' }}
                      />
                      <textarea 
                        placeholder="Provide feedback..." 
                        value={s.feedback || ''}
                        onChange={e => updateFeedback(s.id, e.target.value)}
                        style={{ width: '100%', padding: '8px', marginBottom: '10px' }}
                        rows="3"
                      />
                    </div>
                  </div>
                ))}
              </div>
            </section>
            
            <section>
              <h3>Student Questions ({questions.length})</h3>
              <div className="quick-actions">
                {questions.map(q => (
                  <div key={q.id} className="item-card">
                    <h4>Question #{q.id}</h4>
                    <p><strong>Question:</strong> {q.question}</p>
                    <textarea 
                      placeholder="Type your answer here..." 
                      onChange={e => answerQuestion(q.id, e.target.value)}
                      style={{ width: '100%', padding: '8px', marginTop: '10px' }}
                      rows="3"
                    />
                    <button 
                      onClick={() => answerQuestion(q.id, document.querySelector(`textarea[placeholder="Type your answer here..."]`).value)}
                      className="btn-primary"
                      style={{ marginTop: '10px', width: '100%' }}
                    >
                      Submit Answer
                    </button>
                  </div>
                ))}
              </div>
            </section>
          </main>
        </div>
      );
    };

    // ExamAdminDashboard Component
    const ExamAdminDashboard = ({ 
      currentUser, 
      assessments, 
      submissions, 
      users, 
      handleLogout, 
      goToProfile 
    }) => {
      // Group submissions by assessment
      const groupedSubmissions = {};
      assessments.forEach(assessment => {
        const assessmentSubmissions = submissions.filter(s => s.assessmentId === assessment.id);
        if (assessmentSubmissions.length > 0) {
          groupedSubmissions[assessment.id] = {
            assessment,
            submissions: assessmentSubmissions
          };
        }
      });

      // Calculate average grades per assessment
      const assessmentStats = assessments.map(assessment => {
        const assessmentSubmissions = submissions.filter(s => s.assessmentId === assessment.id && s.grade);
        const totalGrade = assessmentSubmissions.reduce((sum, s) => sum + parseFloat(s.grade || 0), 0);
        const averageGrade = assessmentSubmissions.length > 0 ? totalGrade / assessmentSubmissions.length : 0;
        
        return {
          ...assessment,
          submissionCount: assessmentSubmissions.length,
          averageGrade: averageGrade.toFixed(2)
        };
      });

      return (
        <div className="main-container">
          <header>
            <div style={{ display: 'flex', alignItems: 'center' }}>
              <img src="Images/Logo.png" alt="EduConnect Logo" className="logo" />
              <h1>Welcome, {currentUser.name} (Exam Administrator)</h1>
            </div>
            <div>
              <button onClick={goToProfile} className="btn-secondary">Profile</button>
              <button onClick={handleLogout} className="btn-danger">Logout</button>
            </div>
          </header>
          <main>
            <section className="welcome-banner">
              <h2 className="welcome-title">Exam Administration Dashboard</h2>
              <p className="welcome-subtitle">
                Monitor assessment results, grades, and feedback across all courses
              </p>
            </section>
            
            <section>
              <h3>Assessment Statistics ({assessments.length})</h3>
              <div className="quick-actions">
                {assessmentStats.map(stat => (
                  <div key={stat.id} className="item-card">
                    <h4>{stat.title}</h4>
                    <p><strong>Course:</strong> {stat.course}</p>
                    <p><strong>Submissions:</strong> {stat.submissionCount}</p>
                    <p><strong>Average Grade:</strong> {stat.averageGrade}%</p>
                    <p><strong>Deadline:</strong> {stat.deadline}</p>
                  </div>
                ))}
              </div>
            </section>
            
            <section>
              <h3>Detailed Submission Results ({submissions.length})</h3>
              <div className="quick-actions">
                {Object.values(groupedSubmissions).map(({ assessment, submissions: assessmentSubmissions }) => (
                  <div key={assessment.id} className="item-card">
                    <h4>{assessment.title}</h4>
                    <p><strong>Grading Criteria:</strong> {assessment.criteria}</p>
                    <div style={{ marginTop: '15px' }}>
                      <h5>Student Submissions:</h5>
                      {assessmentSubmissions.map(submission => {
                        const student = users.find(u => u.id === submission.studentId);
                        return (
                          <div key={submission.id} style={{ 
                            padding: '10px', 
                            margin: '5px 0', 
                            backgroundColor: 'rgba(102, 126, 234, 0.05)',
                            borderRadius: '5px'
                          }}>
                            <p><strong>Student:</strong> {student?.name || 'Unknown'}</p>
                            <p><strong>Grade:</strong> {submission.grade || 'Not graded'}</p>
                            <p><strong>Status:</strong> {submission.status}</p>
                            {submission.feedback && (
                              <p><strong>Feedback:</strong> {submission.feedback}</p>
                            )}
                          </div>
                        );
                      })}
                    </div>
                  </div>
                ))}
              </div>
            </section>
          </main>
        </div>
      );
    };

    // ProfilePage Component
    const ProfilePage = ({ currentUser, setCurrentUser, users, setUsers, goBack, handleLogout }) => {
      const [profileData, setProfileData] = useState({ 
        name: currentUser.name, 
        email: currentUser.email,
        password: ''
      });

      const handleUpdate = (e) => {
        e.preventDefault();
        const updatedUser = { 
          ...currentUser, 
          name: profileData.name, 
          email: profileData.email
        };
        
        // Update password if provided
        if (profileData.password) {
          updatedUser.password = profileData.password;
        }
        
        setCurrentUser(updatedUser);
        
        // Update in users array
        const updatedUsers = users.map(u => 
          u.id === currentUser.id ? updatedUser : u
        );
        setUsers(updatedUsers);
        
        // Save to localStorage
        localStorage.setItem('currentUser', JSON.stringify(updatedUser));
        localStorage.setItem('users', JSON.stringify(updatedUsers));
        
        alert('Profile updated successfully');
        setProfileData({ ...profileData, password: '' });
      };

      return (
        <div className="main-container">
          <header>
            <div style={{ display: 'flex', alignItems: 'center' }}>
              <img src="Images/Logo.png" alt="EduConnect Logo" className="logo" />
              <h1>Profile Settings</h1>
            </div>
            <div>
              <button onClick={goBack} className="btn-secondary">Back to Dashboard</button>
              <button onClick={handleLogout} className="btn-danger">Logout</button>
            </div>
          </header>
          <main>
            <section className="welcome-banner">
              <h2 className="welcome-title">Profile Management</h2>
              <p className="welcome-subtitle">
                Update your personal information and account settings
              </p>
            </section>
            
            <section>
              <h3>Your Profile Information</h3>
              <form onSubmit={handleUpdate} className="form-container" style={{ maxWidth: '600px' }}>
                <div style={{ marginBottom: '20px' }}>
                  <p><strong>Current Role:</strong> {currentUser.role}</p>
                  <p><strong>Account Status:</strong> {currentUser.active ? 'Active' : 'Inactive'}</p>
                </div>
                
                <input 
                  type="text" 
                  placeholder="Full Name" 
                  value={profileData.name} 
                  onChange={e => setProfileData({ ...profileData, name: e.target.value })} 
                  required 
                />
                <input 
                  type="email" 
                  placeholder="Email Address" 
                  value={profileData.email} 
                  onChange={e => setProfileData({ ...profileData, email: e.target.value })} 
                  required 
                />
                <input 
                  type="password" 
                  placeholder="New Password (leave blank to keep current)" 
                  value={profileData.password} 
                  onChange={e => setProfileData({ ...profileData, password: e.target.value })} 
                />
                <button type="submit" className="btn-primary">Update Profile</button>
              </form>
            </section>
          </main>
        </div>
      );
    };

  // SystemAdminDashboard Component (Complete version)
    const SystemAdminDashboard = ({ 
      currentUser, 
      users = [], 
      setUsers, 
      modules = [], 
      setModules,
      classes = [],
      setClasses,
      handleLogout, 
      goToProfile 
    }) => {
      // Safety check - if no currentUser
      if (!currentUser) {
        return (
          <div className="form-container">
            <h2>No User Logged In</h2>
            <p>Please log in to access the admin dashboard.</p>
            <button className="btn-primary" onClick={handleLogout}>
              Go to Login
            </button>
          </div>
        );
      }

      const [userData, setUserData] = useState({ name: '', email: '', password: '', role: '' });
      const [moduleData, setModuleData] = useState({ name: '', description: '' });
      const [classData, setClassData] = useState({ name: '', moduleCode: '' });
      const [showAddUserPopup, setShowAddUserPopup] = useState(false);

      const handleUserSubmit = (e) => {
        e.preventDefault();
        if (users.find(u => u.email === userData.email)) {
          alert('User already exists');
          return;
        }
        const newUser = { 
          id: Date.now(), 
          name: userData.name, 
          email: userData.email, 
          password: userData.password, 
          role: userData.role, 
          active: true 
        };
        const updatedUsers = [...users, newUser];
        setUsers(updatedUsers);
        localStorage.setItem('users', JSON.stringify(updatedUsers));
        setUserData({ name: '', email: '', password: '', role: '' });
        setShowAddUserPopup(false);
        alert('User created');
      };

      const toggleUser = (userId) => {
        const updatedUsers = users.map(u => 
          u.id === userId ? { ...u, active: !u.active } : u
        );
        setUsers(updatedUsers);
        localStorage.setItem('users', JSON.stringify(updatedUsers));
      };

      const handleModuleSubmit = (e) => {
        e.preventDefault();
        const getInitials = (name) => {
          if (!name) return 'MOD';
          return name.split(' ')
            .map(w => w[0])
            .join('')
            .toUpperCase()
            .slice(0, 3);
        };
        
        const now = new Date();
        const mm = String(now.getMonth() + 1).padStart(2, '0');
        const yyyy = now.getFullYear();
        const code = `${getInitials(moduleData.name)}-${mm}${yyyy}`;
        
        const newModule = { 
          code, 
          name: moduleData.name, 
          description: moduleData.description, 
          instructorId: null, 
          examAdminId: null 
        };
        
        const updatedModules = [...modules, newModule];
        setModules(updatedModules);
        localStorage.setItem('modules', JSON.stringify(updatedModules));
        setModuleData({ name: '', description: '' });
        alert(`Module created with code: ${code}`);
      };

      const deleteModule = (moduleCode) => {
        if (window.confirm('Are you sure you want to delete this module?')) {
          const updatedModules = modules.filter(m => m.code !== moduleCode);
          setModules(updatedModules);
          localStorage.setItem('modules', JSON.stringify(updatedModules));
        }
      };

      const handleClassSubmit = (e) => {
        e.preventDefault();
        const newClass = { 
          id: Date.now(), 
          name: classData.name, 
          moduleCode: classData.moduleCode, 
          students: [] 
        };
        const updatedClasses = [...classes, newClass];
        setClasses(updatedClasses);
        localStorage.setItem('classes', JSON.stringify(updatedClasses));
        setClassData({ name: '', moduleCode: '' });
        alert('Class created');
      };

      const deleteClass = (classId) => {
        if (window.confirm('Are you sure you want to delete this class?')) {
          const updatedClasses = classes.filter(c => c.id !== classId);
          setClasses(updatedClasses);
          localStorage.setItem('classes', JSON.stringify(updatedClasses));
        }
      };

      return (
        <div className="main-container">
          {/* Header */}
          <header>
            <div style={{ display: 'flex', alignItems: 'center' }}>
              <img src="Images/Logo.png" alt="EduConnect Logo" className="logo" />
              <h1>Welcome, {currentUser.name} (System Administrator)</h1>
            </div>
            <div>
              <button className="btn-secondary" onClick={goToProfile}>Profile</button>
              <button className="btn-danger" onClick={handleLogout}>Logout</button>
            </div>
          </header>

          {/* Main Content */}
          <main>
            <section className="welcome-banner">
              <h2 className="welcome-title">System Administrator Dashboard</h2>
              <p className="welcome-subtitle">
                Manage users, modules, classes, and system settings
              </p>
            </section>

            {/* Quick Actions */}
            <section>
              <h3>Quick Actions</h3>
              <div className="quick-actions">
                <div className="item-card">
                  <div className="action-card-icon">
                    <i className="fas fa-user-plus"></i>
                  </div>
                  <h4 className="action-card-title">Create User Account</h4>
                  <p className="action-card-description">
                    Add new students, instructors, or administrators to the system
                  </p>
                  <button className="action-btn" onClick={() => setShowAddUserPopup(true)}>
                    <i className="fas fa-plus"></i> Add User
                  </button>
                </div>
                
                <div className="item-card">
                  <div className="action-card-icon">
                    <i className="fas fa-book"></i>
                  </div>
                  <h4 className="action-card-title">Manage Modules</h4>
                  <p className="action-card-description">
                    Create and manage course modules for the academic system
                  </p>
                  <button className="action-btn" onClick={() => document.getElementById('manage-modules')?.scrollIntoView({ behavior: 'smooth' })}>
                    <i className="fas fa-arrow-right"></i> View Modules
                  </button>
                </div>
                
                <div className="item-card">
                  <div className="action-card-icon">
                    <i className="fas fa-users"></i>
                  </div>
                  <h4 className="action-card-title">User Management</h4>
                  <p className="action-card-description">
                    View and manage all user accounts in the system
                  </p>
                  <button className="action-btn" onClick={() => document.getElementById('manage-users')?.scrollIntoView({ behavior: 'smooth' })}>
                    <i className="fas fa-arrow-right"></i> Manage Users
                  </button>
                </div>
              </div>
            </section>

            {/* Add User Popup */}
            {showAddUserPopup && (
              <div className="popup-overlay">
                <div className="popup-content">
                  <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '20px' }}>
                    <h2 style={{
                      fontSize: '28px',
                      fontWeight: '300',
                      background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                      WebkitBackgroundClip: 'text',
                      WebkitTextFillColor: 'transparent',
                      margin: 0
                    }}>
                      Add New User
                    </h2>
                    <button 
                      onClick={() => setShowAddUserPopup(false)}
                      style={{ background: 'none', border: 'none', fontSize: '24px', cursor: 'pointer', color: '#666' }}
                    >
                      ×
                    </button>
                  </div>
                  
                  <form onSubmit={handleUserSubmit}>
                    <input 
                      type="text" 
                      placeholder="Full Name" 
                      value={userData.name} 
                      onChange={(e) => setUserData({ ...userData, name: e.target.value })} 
                      required
                    />
                    <input 
                      type="email" 
                      placeholder="Email Address" 
                      value={userData.email} 
                      onChange={(e) => setUserData({ ...userData, email: e.target.value })} 
                      required
                    />
                    <input 
                      type="password" 
                      placeholder="Password" 
                      value={userData.password} 
                      onChange={(e) => setUserData({ ...userData, password: e.target.value })} 
                      required
                    />
                    <select 
                      value={userData.role} 
                      onChange={(e) => setUserData({ ...userData, role: e.target.value })} 
                      required
                    >
                      <option value="">Select Role</option>
                      <option value="Student">Student</option>
                      <option value="Instructor">Instructor</option>
                      <option value="System Administrator">System Administrator</option>
                      <option value="Exam Administrator">Exam Administrator</option>
                    </select>
                    <div style={{ display: 'flex', gap: '10px', marginTop: '20px' }}>
                      <button type="submit" className="btn-primary" style={{ flex: 1 }}>Create User</button>
                      <button type="button" onClick={() => setShowAddUserPopup(false)} className="btn-secondary" style={{ flex: 1 }}>Cancel</button>
                    </div>
                  </form>
                </div>
              </div>
            )}
            
            {/* Manage Users */}
            <section id="manage-users">
              <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '20px' }}>
                <h3>Manage Users ({users.length})</h3>
                <button 
                  onClick={() => setShowAddUserPopup(true)}
                  className="btn-primary"
                  style={{ display: 'flex', alignItems: 'center', gap: '8px' }}
                >
                  <i className="fas fa-plus"></i> Add User
                </button>
              </div>
              <div className="quick-actions">
                {users.map(u => (
                  <div key={u.id} className="item-card">
                    <h4>{u.name}</h4>
                    <p><strong>Email:</strong> {u.email}</p>
                    <p><strong>Role:</strong> {u.role}</p>
                    <p><strong>Status:</strong> {u.active ? '✅ Active' : '❌ Inactive'}</p>
                    <button 
                      onClick={() => toggleUser(u.id)}
                      className={u.active ? 'btn-danger' : 'btn-success'}
                      style={{ marginTop: '10px', width: '100%' }}
                    >
                      {u.active ? 'Deactivate Account' : 'Activate Account'}
                    </button>
                  </div>
                ))}
              </div>
            </section>
            
            {/* Create Module */}
            <section>
              <h3>Create Module</h3>
              <form onSubmit={handleModuleSubmit} className="form-container" style={{ maxWidth: '600px', margin: '0 auto' }}>
                <input 
                  type="text" 
                  placeholder="Module Name (e.g., Software Development)" 
                  value={moduleData.name} 
                  onChange={(e) => setModuleData({ ...moduleData, name: e.target.value })} 
                  required
                />
                <textarea 
                  placeholder="Module Description" 
                  value={moduleData.description} 
                  onChange={(e) => setModuleData({ ...moduleData, description: e.target.value })} 
                  required
                  rows="4"
                />
                <button type="submit" className="btn-primary">Create Module</button>
              </form>
            </section>
            
            {/* Manage Modules */}
            <section id="manage-modules">
              <h3>Manage Modules ({modules.length})</h3>
              <div className="quick-actions">
                {modules.map(m => (
                  <div key={m.code} className="item-card">
                    <h4>{m.name}</h4>
                    <p><strong>Code:</strong> {m.code}</p>
                    <p><strong>Description:</strong> {m.description}</p>
                    <button 
                      onClick={() => deleteModule(m.code)}
                      className="btn-danger"
                      style={{ marginTop: '10px', width: '100%' }}
                    >
                      Delete Module
                    </button>
                  </div>
                ))}
              </div>
            </section>
            
            {/* Create Class */}
            <section>
              <h3>Create Class</h3>
              <form onSubmit={handleClassSubmit} className="form-container" style={{ maxWidth: '600px', margin: '0 auto' }}>
                <input 
                  type="text" 
                  placeholder="Class Name (e.g., SDM Class A)" 
                  value={classData.name} 
                  onChange={(e) => setClassData({ ...classData, name: e.target.value })} 
                  required
                />
                <select 
                  value={classData.moduleCode} 
                  onChange={(e) => setClassData({ ...classData, moduleCode: e.target.value })} 
                  required
                >
                  <option value="">Select Module</option>
                  {modules.map(m => (
                    <option key={m.code} value={m.code}>
                      {m.name} ({m.code})
                    </option>
                  ))}
                </select>
                <button type="submit" className="btn-primary">Create Class</button>
              </form>
            </section>
            
            {/* Manage Classes */}
            <section>
              <h3>Manage Classes ({classes.length})</h3>
              <div className="quick-actions">
                {classes.map(c => (
                  <div key={c.id} className="item-card">
                    <h4>{c.name}</h4>
                    <p><strong>Module:</strong> {modules.find(m => m.code === c.moduleCode)?.name || 'Unknown'}</p>
                    <p><strong>Module Code:</strong> {c.moduleCode}</p>
                    <p><strong>Students:</strong> {c.students?.length || 0}</p>
                    <button 
                      onClick={() => deleteClass(c.id)}
                      className="btn-danger"
                      style={{ marginTop: '10px', width: '100%' }}
                    >
                      Delete Class
                    </button>
                  </div>
                ))}
              </div>
            </section>
          </main>
        </div>
      );
    };

    // HomePage Component (Main App Controller)
    const HomePage = () => {
      const [page, setPage] = useState('login');
      const [users, setUsers] = useState([]);
      const [assessments, setAssessments] = useState([]);
      const [submissions, setSubmissions] = useState([]);
      const [questions, setQuestions] = useState([]);
      const [modules, setModules] = useState([]);
      const [classes, setClasses] = useState([]);
      const [currentUser, setCurrentUser] = useState(null);
      const [loginData, setLoginData] = useState({ email: '', password: '' });
      const [registerData, setRegisterData] = useState({ name: '', email: '', password: '', role: '' });
      const [isLoading, setIsLoading] = useState(true);

      useEffect(() => {
        console.log('HomePage useEffect running...');
        
        try {
          // Load all data from localStorage
          const storedUsers = JSON.parse(localStorage.getItem('users')) || [];
          const storedAssessments = JSON.parse(localStorage.getItem('assessments')) || [];
          const storedSubmissions = JSON.parse(localStorage.getItem('submissions')) || [];
          const storedQuestions = JSON.parse(localStorage.getItem('questions')) || [];
          const storedModules = JSON.parse(localStorage.getItem('modules')) || [];
          const storedClasses = JSON.parse(localStorage.getItem('classes')) || [];
          
          console.log('Loaded users from localStorage:', storedUsers.length);
          console.log('Loaded modules from localStorage:', storedModules.length);
          
          // Create default admin if no users exist
          let updatedUsers = storedUsers;
          if (storedUsers.length === 0) {
            console.log('No users found, creating default admin...');
            const defaultAdmin = {
              id: Date.now(),
              name: 'System Administrator',
              email: 'admin@educonnect.com',
              password: 'admin123',
              role: 'System Administrator',
              active: true
            };
            updatedUsers = [defaultAdmin];
            localStorage.setItem('users', JSON.stringify(updatedUsers));
            console.log('Default admin created:', defaultAdmin);
          }
          
          // Create default modules if none exist
          let updatedModules = storedModules;
          if (storedModules.length === 0) {
            console.log('No modules found, creating default modules...');
            const defaultModules = [
              { 
                code: 'NWT-112025', 
                name: 'Networking Technologies', 
                description: 'Basic networking concepts and technologies',
                instructorId: null,
                examAdminId: null
              },
              { 
                code: 'OOP-112025', 
                name: 'Object-Oriented Programming', 
                description: 'Advanced object-oriented programming concepts',
                instructorId: null,
                examAdminId: null
              },
              { 
                code: 'SDM-112025', 
                name: 'Software Development Methods', 
                description: 'Software development methodologies and practices',
                instructorId: null,
                examAdminId: null
              }
            ];
            updatedModules = defaultModules;
            localStorage.setItem('modules', JSON.stringify(updatedModules));
          }
          
          // Create default classes if none exist
          let updatedClasses = storedClasses;
          if (storedClasses.length === 0 && updatedModules.length > 0) {
            console.log('No classes found, creating default classes...');
            const defaultClasses = [
              { 
                id: Date.now(), 
                name: 'Networking Technologies Class A', 
                moduleCode: 'NWT-112025', 
                students: [] 
              },
              { 
                id: Date.now() + 1, 
                name: 'Object-Oriented Programming Class B', 
                moduleCode: 'OOP-112025', 
                students: [] 
              },
              { 
                id: Date.now() + 2, 
                name: 'Software Development Methods Class C', 
                moduleCode: 'SDM-112025', 
                students: [] 
              }
            ];
            updatedClasses = defaultClasses;
            localStorage.setItem('classes', JSON.stringify(updatedClasses));
          }
          
          setUsers(updatedUsers);
          setAssessments(storedAssessments);
          setSubmissions(storedSubmissions);
          setQuestions(storedQuestions);
          setModules(updatedModules);
          setClasses(updatedClasses);
          
          const storedUser = JSON.parse(localStorage.getItem('currentUser'));
          console.log('Stored user from localStorage:', storedUser);
          
          if (storedUser) {
            setCurrentUser(storedUser);
            if (storedUser.role === 'Student') {
              setPage('student-dashboard');
            } else if (storedUser.role === 'Instructor') {
              setPage('instructor-dashboard');
            } else if (storedUser.role === 'Exam Administrator') {
              setPage('exam-admin-dashboard');
            } else if (storedUser.role === 'System Administrator') {
              setPage('admin-dashboard');
            } else {
              console.warn('Unknown role:', storedUser.role);
              setPage('login');
            }
          } else {
            console.log('No stored user found');
            const hasAdmin = updatedUsers.some(u => u.role === 'System Administrator');
            if (updatedUsers.length === 0 || !hasAdmin) {
              setPage('register');
            } else {
              setPage('login');
            }
          }
        } catch (error) {
          console.error('Error loading data:', error);
          setPage('login');
        } finally {
          setIsLoading(false);
          console.log('Initialization complete, page:', page);
        }
      }, []);

      const saveData = () => {
        try {
          localStorage.setItem('users', JSON.stringify(users));
          localStorage.setItem('assessments', JSON.stringify(assessments));
          localStorage.setItem('submissions', JSON.stringify(submissions));
          localStorage.setItem('questions', JSON.stringify(questions));
          localStorage.setItem('modules', JSON.stringify(modules));
          localStorage.setItem('classes', JSON.stringify(classes));
          if (currentUser) {
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
          }
        } catch (error) {
          console.error('Error saving data:', error);
        }
      };

      const handleLogin = (e) => {
        e.preventDefault();
        console.log('Login attempt with:', loginData.email);
        console.log('Available users:', users.length);
        
        const user = users.find(u => 
          u.email === loginData.email && 
          u.password === loginData.password && 
          u.active !== false
        );
        
        if (user) {
          console.log('User found:', user.name);
          setCurrentUser(user);
          localStorage.setItem('currentUser', JSON.stringify(user));
          
          if (user.role === 'Student') {
            setPage('student-dashboard');
          } else if (user.role === 'Instructor') {
            setPage('instructor-dashboard');
          } else if (user.role === 'Exam Administrator') {
            setPage('exam-admin-dashboard');
          } else if (user.role === 'System Administrator') {
            setPage('admin-dashboard');
          } else {
            console.warn('Unknown role after login:', user.role);
            setPage('login');
          }
        } else {
          console.log('Login failed - no matching user found');
          alert('Invalid credentials or account deactivated');
        }
      };

      const handleRegister = (e) => {
        e.preventDefault();
        
        // Check if user already exists
        const existingUser = users.find(u => u.email === registerData.email);
        if (existingUser) {
          alert('User already exists with this email');
          return;
        }
        
        const newUser = { 
          id: Date.now(), 
          name: registerData.name, 
          email: registerData.email, 
          password: registerData.password, 
          role: registerData.role, 
          active: true 
        };
        
        const updatedUsers = [...users, newUser];
        setUsers(updatedUsers);
        setCurrentUser(newUser);
        
        // Save to localStorage
        localStorage.setItem('users', JSON.stringify(updatedUsers));
        localStorage.setItem('currentUser', JSON.stringify(newUser));
        
        console.log('New user registered:', newUser);
        
        if (newUser.role === 'Student') {
          setPage('student-dashboard');
        } else if (newUser.role === 'Instructor') {
          setPage('instructor-dashboard');
        } else if (newUser.role === 'Exam Administrator') {
          setPage('exam-admin-dashboard');
        } else if (newUser.role === 'System Administrator') {
          setPage('admin-dashboard');
        } else {
          console.warn('Unknown role after registration:', newUser.role);
          setPage('login');
        }
      };

      const handleLogout = () => {
        console.log('Logging out user:', currentUser?.name);
        setCurrentUser(null);
        localStorage.removeItem('currentUser');
        setPage('login');
        setLoginData({ email: '', password: '' });
      };

      const goToRegister = () => {
        console.log('Going to register page');
        setPage('register');
        setRegisterData({ name: '', email: '', password: '', role: '' });
      };

      const goToLogin = () => {
        console.log('Going to login page');
        setPage('login');
        setLoginData({ email: '', password: '' });
      };

      const goToProfile = () => {
        console.log('Going to profile page');
        setPage('profile');
      };

      const goBack = () => {
        console.log('Going back from profile');
        if (!currentUser) {
          setPage('login');
          return;
        }
        
        if (currentUser.role === 'Student') {
          setPage('student-dashboard');
        } else if (currentUser.role === 'Instructor') {
          setPage('instructor-dashboard');
        } else if (currentUser.role === 'Exam Administrator') {
          setPage('exam-admin-dashboard');
        } else if (currentUser.role === 'System Administrator') {
          setPage('admin-dashboard');
        } else {
          setPage('login');
        }
      };

      // Show loading screen
      if (isLoading) {
        return (
          <div className="loading-screen">
            <div className="loading-spinner"></div>
            <h2>Loading EduConnect System...</h2>
            <p>Please wait while we initialize the application.</p>
          </div>
        );
      }

      // Render the appropriate page based on state
      switch(page) {
        case 'login':
          return (
            <LoginPage 
              loginData={loginData} 
              setLoginData={setLoginData} 
              handleLogin={handleLogin} 
              goToRegister={goToRegister} 
            />
          );
          
        case 'register':
          return (
            <RegisterPage 
              registerData={registerData} 
              setRegisterData={setRegisterData} 
              handleRegister={handleRegister} 
              goToLogin={goToLogin} 
            />
          );
          
        case 'student-dashboard':
          return (
            <StudentDashboard 
              currentUser={currentUser} 
              assessments={assessments} 
              submissions={submissions} 
              questions={questions} 
              setSubmissions={setSubmissions} 
              setQuestions={setQuestions} 
              handleLogout={handleLogout} 
              goToProfile={goToProfile} 
            />
          );
          
        case 'instructor-dashboard':
          return (
            <InstructorDashboard 
              currentUser={currentUser} 
              assessments={assessments} 
              submissions={submissions} 
              questions={questions} 
              setAssessments={setAssessments} 
              setSubmissions={setSubmissions} 
              setQuestions={setQuestions} 
              handleLogout={handleLogout} 
              goToProfile={goToProfile} 
            />
          );
          
        case 'exam-admin-dashboard':
          return (
            <ExamAdminDashboard 
              currentUser={currentUser} 
              assessments={assessments} 
              submissions={submissions} 
              users={users}
              handleLogout={handleLogout} 
              goToProfile={goToProfile} 
            />
          );
          
        case 'admin-dashboard':
          return (
            <SystemAdminDashboard 
              currentUser={currentUser} 
              users={users} 
              setUsers={setUsers}
              modules={modules}
              setModules={setModules}
              classes={classes}
              setClasses={setClasses}
              handleLogout={handleLogout} 
              goToProfile={goToProfile} 
            />
          );
          
        case 'profile':
          return (
            <ProfilePage 
              currentUser={currentUser} 
              setCurrentUser={setCurrentUser} 
              users={users} 
              setUsers={setUsers} 
              goBack={goBack} 
              handleLogout={handleLogout} 
            />
          );
          
        default:
          return (
            <div className="error-page">
              <h2>Page Not Found</h2>
              <p>The page "{page}" could not be found.</p>
              <button onClick={goToLogin} className="btn-primary">
                Go to Login Page
              </button>
            </div>
          );
      }
    };

    // Main App Component
    function App() {
      return (
        <div className="App">
          <HomePage />
        </div>
      );
    }

    // Render the app
    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>